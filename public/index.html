<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL Injection Lab - Login</title>
  </head>
  <body>
    <h1>SQL Injection Learning Lab</h1>
    <p>
      <strong>Objective:</strong> Use blind SQL injection to extract the admin
      password and capture the flag!
    </p>

    <div id="loginForm">
      <h2>Login</h2>
      <form id="loginFormElement">
        <div>
          <label for="username">Username:</label>
          <input type="text" id="username" name="username" required />
        </div>
        <div>
          <label for="password">Password:</label>
          <input type="password" id="password" name="password" required />
        </div>
        <button type="submit">Login</button>
      </form>
    </div>

    <div id="dashboard" style="display: none">
      <h2>Dashboard</h2>
      <div id="userInfo"></div>
      <button onclick="logout()">Logout</button>
    </div>

    <div id="message" style="margin-top: 20px"></div>

    <hr />

    <div style="background-color: #f0f0f0; padding: 15px; margin-top: 20px">
      <h3>Lab Hints:</h3>
      <ul>
        <li>
          Try basic SQL injection in the username field:
          <code>' OR '1'='1</code>
        </li>
        <li>
          For blind SQL injection, you'll need to use boolean-based techniques
        </li>
        <li>
          The admin's password contains only lowercase letters and numbers
        </li>
        <li>Password length: 24 characters</li>
        <li>Try using <code>SUBSTRING()</code> and boolean conditions</li>
      </ul>
    </div>

    <script>
      document
        .getElementById("loginFormElement")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;

          fetch("/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ username, password }),
          })
            .then((response) => response.json())
            .then((data) => {
              const messageDiv = document.getElementById("message");
              if (data.success) {
                messageDiv.innerHTML = `<p style="color: green;">${data.message}</p>`;
                document.getElementById("loginForm").style.display = "none";
                document.getElementById("dashboard").style.display = "block";
                document.getElementById("userInfo").innerHTML = `
                        <p>Welcome, <strong>${data.user.username}</strong>!</p>
                        <p>Your Flag: <strong>${data.user.flag}</strong></p>
                    `;
              } else {
                messageDiv.innerHTML = `<p style="color: red;">${data.message}</p>`;
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              document.getElementById(
                "message"
              ).innerHTML = `<p style="color: red;">Login failed</p>`;
            });
        });

      function logout() {
        document.getElementById("loginForm").style.display = "block";
        document.getElementById("dashboard").style.display = "none";
        document.getElementById("username").value = "";
        document.getElementById("password").value = "";
        document.getElementById("message").innerHTML = "";
      }
    </script>
  </body>
</html>
